<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeni İhbar - ŞehirSesi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="new-complaint-page">


<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Şehrimizin Sesi</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
 
    <div class="collapse navbar-collapse justify-content-end align-items-center" id="navbarNav">
      <ul class="navbar-nav d-flex gap-3">
        <li class="nav-item"><a class="nav-link" href="index.html">Anasayfa</a></li>
        <li class="nav-item"><a class="nav-link" href="canli-takip.html">Canlı Takip</a></li>
        <li class="nav-item"><a class="nav-link active" href="yeni-ihbar.html">Yeni İhbar</a></li>
        <li class="nav-item"><a class="nav-link" href="hakkimizda.html">Hakkımızda</a></li>
      </ul>
      <a class="btn auth-btn ms-3" data-bs-toggle="modal" data-bs-target="#authModal">Giriş Yap / Kayıt Ol</a>
    </div>
  </div>
</nav>

<!-- Giriş / Kayıt Modal -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Giriş Yap / Kayıt Ol</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Tabs -->
        <ul class="nav nav-tabs" id="authTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button">Giriş Yap</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button">Kayıt Ol</button>
          </li>
        </ul>
        <div class="tab-content mt-3">
          <!-- Login Tab -->
          <div class="tab-pane fade show active" id="login">
            <form id="loginForm">
              <div class="mb-3">
                <label for="loginEmail" class="form-label">E-posta</label>
                <input type="email" class="form-control" id="loginEmail" required>
              </div>
              <div class="mb-3">
                <label for="loginPassword" class="form-label">Şifre</label>
                <input type="password" class="form-control" id="loginPassword" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">Giriş Yap</button>
            </form>
          </div>
          <!-- Register Tab -->
<div class="tab-pane fade" id="register">
  <form id="registerForm">
    <div class="mb-3">
      <label for="registerFirstName" class="form-label">Ad</label>
      <input type="text" class="form-control" id="registerFirstName" required>
    </div>
    <div class="mb-3">
      <label for="registerLastName" class="form-label">Soyad</label>
      <input type="text" class="form-control" id="registerLastName" required>
    </div>
    <div class="mb-3">
      <label for="registerEmail" class="form-label">E-posta</label>
      <input type="email" class="form-control" id="registerEmail" required>
    </div>
    <div class="mb-3">
      <label for="registerPassword" class="form-label">Şifre</label>
      <input type="password" class="form-control" id="registerPassword" required>
    </div>
    <button type="submit" class="btn btn-success w-100">Kayıt Ol</button>
  </form>
</div>

        </div>
      </div>
    </div>
  </div>
</div>


<!-- JS: Modal Formlar -->


   <div class="container mt-4 text-white">
    <h2 class="section-title text-center mb-2">Yeni İhbar Oluştur</h2>
    
    <div class="form-wrapper">
    <form id="newComplaintForm" class="mt-3">
        <div class="mb-3">
            <label for="complaintTitle" class="form-label">Başlık</label>
            <input type="text" class="form-control" id="complaintTitle" required>
        </div>
        <div class="mb-3">
            <label for="complaintDescription" class="form-label">Açıklama</label>
            <textarea class="form-control" id="complaintDescription" rows="4" required></textarea>
        </div>
        <div class="mb-3">
            <label for="complaintLocation" class="form-label">Konum</label>
            <input type="text" class="form-control" id="complaintLocation">
        </div>
        <div class="mb-3">
            <label for="complaintPhone" class="form-label">Telefon Numarası</label>
            <input type="tel" class="form-control" id="complaintPhone" name="phone" placeholder="05xx xxx xx xx">
        </div>
        <button type="submit" class="btn btn-success">İhbarı Gönder</button>
    </form>
</div>


  <script>
const API_URL = "https://urgent-abbye-nisaprojects-e8de76ae.koyeb.app";

function showError(message) {
    alert(message);
}

/* =====================
   YENİ İHBAR
===================== */
document.getElementById('newComplaintForm').addEventListener('submit', async function(e){
    e.preventDefault();

    const title = document.getElementById('complaintTitle').value.trim();
    const description = document.getElementById('complaintDescription').value.trim();
    const location = document.getElementById('complaintLocation').value.trim();

    if (title.length < 3) {
        showError("Başlık en az 3 karakter olmalıdır.");
        return;
    }

    if (description.length < 10) {
        showError("Açıklama en az 10 karakter olmalıdır.");
        return;
    }

    try {
        const res = await fetch(`${API_URL}/complaints`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, description, location })
        });

        if (!res.ok) throw new Error("Sunucu hatası");

        const data = await res.json();
        alert(`İhbar başarıyla eklendi! (ID: ${data.id})`);
        this.reset();

    } catch (err) {
        showError("İhbar eklenirken hata oluştu.");
    }
});

/* =====================
   REGISTER
===================== */
document.getElementById('registerForm').addEventListener('submit', async function(e){
    e.preventDefault();

    const firstName = document.getElementById('registerFirstName').value;
    const lastName = document.getElementById('registerLastName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;

    try {
        const res = await fetch(`${API_URL}/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ firstName, lastName, email, password })
        });

        const data = await res.json();

        if (res.ok) {
            alert("Kayıt başarılı!");
            bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
            this.reset();
        } else {
            showError(data.error);
        }

    } catch {
        showError("Kayıt sırasında hata oluştu");
    }
});

/* =====================
   LOGIN
===================== */
document.getElementById('loginForm').addEventListener('submit', async function(e){
    e.preventDefault();

    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    try {
        const res = await fetch(`${API_URL}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });

        const data = await res.json();

        if (res.ok) {
            alert(`Giriş başarılı!`);
            bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
            this.reset();
        } else {
            showError(data.error);
        }

    } catch {
        showError("Giriş sırasında hata oluştu");
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<footer id="main-copyright-footer" class="mt-4">
  <div class="text-center text-white">
    © 2026 Şehrimizin Sesi | Tüm Hakları Saklıdır
  </div>
</footer>
</body>
</html>
